<!DOCTYPE html>

<script type="text/stache" id="demo-html">
    <h1>Crud Manager Demo</h1>
    <p>Deferreds may not be completely resolved in this example since there is no
    actual server backend. Therefore messages will not be displayed and items may
    or may not actually be edited or deleted. In addition, the count and pagination
    may not be completely accurate without an actual server backend.
    <br />
    <crud-manager {view}="view" />
</script>
<script src="../node_modules/steal/steal.js" main="@empty" id="demo-source">
    import 'bootstrap/dist/css/bootstrap.min.css!';
    import 'bootstrap/dist/css/bootstrap-theme.min.css!';
    import 'bootstrap';
    import 'font-awesome/css/font-awesome.min.css';
    import 'crud-manager/';

    import SuperMap from 'can-connect/can/super-map/';
    import DefineMap from 'can-define/map/map';
    import DefineList from 'can-define/list/list';
    import data from 'test/data/tasks.json';
    import 'test/data/fixtures';
    import stache from 'can-stache';

    const TaskMap = DefineMap.extend({
      "name": { value: "name of task" },
      "description": { value: "description of task" },
      "completed": { value: false, type: 'boolean' }
    });

    const TaskList = DefineList.extend({
        map: TaskMap
    });

    const Connection = SuperMap({
        idProp: "id",
        Map: TaskMap,
        List: TaskList,
        url: "/tasks",
        name: "task",
        metadata: {
          total: data.length
        }
    });

    let viewModel = new DefineMap({
        view: {
            title: 'Tasks',
            connection: Connection,
            manageButtons: [{
                textClass: 'text-success',
                buttonClass: 'btn btn-success',
                text: 'Mark Completed',
                iconClass: 'fa fa-fw fa-check-square-o',
                onClick(objs) {
                    if (!objs.length) {
                        objs = [objs];
                    }
                    objs.forEach(obj => {
                        obj.completed= true;
                        Connection.save(obj);
                    });
                }
            }]
        }
    })


    let frag = stache(document.getElementById('demo-html').innerHTML)(viewModel);

    document.body.appendChild(frag);
</script>
